<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Mô phỏng nước cường toan - Neon Cyan</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      * {
        box-sizing: border-box;
        font-family: "Segoe UI", system-ui, sans-serif;
      }

      body {
        margin: 0;
        padding: 10px;
        display: flex;
        justify-content: center;
        background: #0f172a;
        color: #e5e7eb;
      }

      .container {
        width: 100%;
        max-width: 1100px;
        margin: 10px auto;
        padding: 20px;
        border-radius: 20px;
        background: rgba(15, 23, 42, 0.9);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(56, 189, 248, 0.3);
        box-shadow: 0 0 30px rgba(34, 211, 238, 0.25);
      }

      h1 {
        text-align: center;
        margin: 0 0 15px;
        color: #67e8f9;
        text-shadow: 0 0 6px #22d3ee;
        font-size: clamp(1.4rem, 4vw, 2rem);
      }

      .top-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 10px;
        font-size: 14px;
        color: #e5e7eb;
      }

      .reset-btn {
        padding: 8px 16px;
        border-radius: 999px;
        border: none;
        background: rgba(248, 250, 252, 0.1);
        color: #e5e7eb;
        cursor: pointer;
        font-weight: 600;
        box-shadow: 0 0 8px rgba(248, 250, 252, 0.4);
        transition: 0.25s ease;
        white-space: nowrap;
        font-size: 13px;
      }

      .reset-btn:hover {
        background: rgba(248, 250, 252, 0.2);
        box-shadow: 0 0 10px #e5e7eb, 0 0 20px #e5e7eb;
        transform: translateY(-1px);
      }

      .beakers {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 20px;
        align-items: stretch;
      }

      .card {
        background: radial-gradient(
          circle at top,
          rgba(15, 118, 190, 0.25),
          rgba(15, 23, 42, 0.9)
        );
        border-radius: 16px;
        border: 1px solid rgba(56, 189, 248, 0.4);
        padding: 15px;
        font-size: 14px;
        box-shadow: 0 0 18px rgba(8, 47, 73, 0.9);
      }

      .card-title {
        font-weight: bold;
        font-size: 16px;
        margin-bottom: 8px;
        color: #7dd3fc;
        text-shadow: 0 0 6px #38bdf8;
      }

      .card-body {
        display: flex;
        gap: 12px;
        align-items: stretch;
      }

      .left-panel {
        flex: 1.1;
        min-width: 0;
        display: flex;
        flex-direction: column;
      }

      .right-panel {
        flex: 1;
        text-align: center;
        min-width: 0;
        display: flex;
        flex-direction: column;
      }

      .controls {
        margin-bottom: 6px;
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }

      .btn {
        padding: 7px 12px;
        border-radius: 999px;
        border: none;
        cursor: pointer;
        font-size: 13px;
        font-weight: 600;
        color: #e5e7eb;
        background: rgba(37, 99, 235, 0.85);
        box-shadow: 0 0 6px rgba(59, 130, 246, 0.7);
        transition: 0.25s ease;
        white-space: nowrap;
      }

      .btn:hover {
        transform: translateY(-2px);
        background: rgba(37, 99, 235, 1);
        box-shadow: 0 0 10px #22d3ee, 0 0 20px #22d3ee, 0 0 30px #22d3ee;
      }

      .btn.green {
        background: rgba(16, 185, 129, 0.85);
        box-shadow: 0 0 6px rgba(45, 212, 191, 0.7);
      }

      .btn.green:hover {
        background: rgba(16, 185, 129, 1);
        box-shadow: 0 0 10px #4ade80, 0 0 20px #4ade80, 0 0 30px #4ade80;
      }

      .result-box {
        padding: 6px;
        border-radius: 12px;
        font-size: 14px;
        background: radial-gradient(
          circle at top left,
          rgba(56, 189, 248, 0.1),
          rgba(15, 23, 42, 0.9)
        );
        border: 1px solid rgba(148, 163, 184, 0.7);
        text-align: left;
        min-height: 60px;
        color: #e0f2fe;
        box-shadow: inset 0 0 10px rgba(56, 189, 248, 0.2);
        line-height: 1.4;
      }

      .result-box.error {
        border-color: rgba(248, 113, 113, 0.95);
        box-shadow: inset 0 0 12px rgba(248, 113, 113, 0.8),
          0 0 12px rgba(248, 113, 113, 0.5);
        color: #fee2e2;
      }

      .heat-area {
        position: relative;
        width: 100%;
        max-width: 120px;
        height: 320px;
        margin: 0 auto 10px;
      }

      /* đẩy ống nghiệm xuống đáy panel để 3 ống ngang hàng hơn */
      .right-panel .heat-area {
        margin-top: auto;
      }

      .beaker {
        width: 80px;
        height: 220px;
        border: 4px solid rgba(56, 189, 248, 0.8);
        border-radius: 30px 30px 14px 14px;
        margin: 0 auto;
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        overflow: hidden;
        background: radial-gradient(circle at top, #1e293b, #020617);
        box-shadow: 0 0 15px rgba(56, 189, 248, 0.8),
          inset 0 0 15px rgba(15, 23, 42, 0.9);
      }

      .solution {
        position: absolute;
        bottom: 0;
        width: 100%;
        height: 0%;
        background: linear-gradient(to top, #22d3ee, #38bdf8);
        box-shadow: inset 0 0 12px rgba(56, 189, 248, 0.9),
          0 0 10px rgba(56, 189, 248, 0.8);
        transition: height 2s ease, background 0.5s ease;
      }

      .gold {
        position: absolute;
        width: 40px;
        height: 14px;
        border-radius: 6px;
        background: linear-gradient(to right, #fef08a, #facc15);
        box-shadow: 0 0 10px rgba(250, 250, 105, 0.9),
          inset 0 0 8px rgba(250, 250, 105, 0.8);
        bottom: 18px;
        left: 50%;
        transform: translateX(-50%) scale(1);
        transition: opacity 0.2s, transform 0.2s;
      }

      #burner1,
      #burner2 {
        position: absolute;
        left: 50%;
        top: 230px;
        transform: translateX(-50%);
        width: 70px;
        height: 90px;
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
        z-index: 5;
      }

      .burner-base {
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 48px;
        height: 20px;
        background: #475569;
        border-radius: 10px 10px 6px 6px;
        box-shadow: 0 0 10px rgba(148, 163, 184, 0.7);
      }

      .burner-neck {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        width: 20px;
        height: 14px;
        background: #94a3b8;
        border-radius: 8px 8px 4px 4px;
      }

      .flame {
        position: absolute;
        bottom: 34px;
        left: 50%;
        transform: translateX(-50%);
        width: 28px;
        height: 48px;
        border-radius: 50% 50% 50% 50% / 65% 65% 35% 35%;
        background: radial-gradient(
          circle at 50% 80%,
          rgba(255, 200, 80, 1) 0%,
          rgba(255, 140, 0, 1) 50%,
          rgba(255, 80, 0, 1) 80%,
          rgba(255, 60, 0, 0.9) 100%
        );
        filter: blur(1px) drop-shadow(0 0 12px rgba(255, 180, 80, 1))
          drop-shadow(0 0 26px rgba(255, 200, 120, 0.9));
        animation: flameFlicker 0.18s infinite ease-in-out;
      }

      .flame-inner {
        position: absolute;
        bottom: 42px;
        left: 50%;
        transform: translateX(-50%);
        width: 16px;
        height: 30px;
        border-radius: 50% 50% 50% 50% / 70% 70% 30% 30%;
        background: radial-gradient(
          circle at 50% 80%,
          rgba(255, 255, 220, 1) 0%,
          rgba(255, 220, 120, 1) 40%,
          rgba(255, 160, 0, 0.95) 100%
        );
        filter: blur(1px) drop-shadow(0 0 18px rgba(255, 255, 200, 1));
        animation: flameFlicker 0.22s infinite ease-in-out;
      }

      @keyframes flameFlicker {
        0% {
          transform: translateX(-50%) scale(1);
        }
        50% {
          transform: translateX(-50%) scale(1.15);
        }
        100% {
          transform: translateX(-50%) scale(0.95);
        }
      }

      .bubbles {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 70%;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .bubble {
        position: absolute;
        bottom: 4px;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.95);
        opacity: 0;
        box-shadow: 0 0 6px rgba(255, 255, 255, 0.9);
      }

      @keyframes rise {
        0% {
          transform: translateY(0) scale(0.4);
          opacity: 0;
        }
        20% {
          opacity: 1;
        }
        100% {
          transform: translateY(-130px) scale(1);
          opacity: 0;
        }
      }

      .bubble1 {
        width: 10px;
        height: 10px;
        left: 18%;
        animation: rise 2.8s infinite ease-out;
        animation-delay: 0s;
      }
      .bubble2 {
        width: 14px;
        height: 14px;
        left: 26%;
        animation: rise 3s infinite ease-out;
        animation-delay: 0.3s;
      }
      .bubble3 {
        width: 9px;
        height: 9px;
        left: 34%;
        animation: rise 2.6s infinite ease-out;
        animation-delay: 0.6s;
      }
      .bubble4 {
        width: 12px;
        height: 12px;
        left: 42%;
        animation: rise 3.2s infinite ease-out;
        animation-delay: 0.9s;
      }
      .bubble5 {
        width: 9px;
        height: 9px;
        left: 50%;
        animation: rise 2.7s infinite ease-out;
        animation-delay: 1.2s;
      }
      .bubble6 {
        width: 13px;
        height: 13px;
        left: 58%;
        animation: rise 3.1s infinite ease-out;
        animation-delay: 1.5s;
      }
      .bubble7 {
        width: 11px;
        height: 11px;
        left: 66%;
        animation: rise 2.9s infinite ease-out;
        animation-delay: 1.8s;
      }
      .bubble8 {
        width: 15px;
        height: 15px;
        left: 74%;
        animation: rise 3.4s infinite ease-out;
        animation-delay: 2.1s;
      }
      .bubble9 {
        width: 10px;
        height: 10px;
        left: 22%;
        animation: rise 3s infinite ease-out;
        animation-delay: 2.4s;
      }
      .bubble10 {
        width: 12px;
        height: 12px;
        left: 30%;
        animation: rise 2.8s infinite ease-out;
        animation-delay: 2.7s;
      }
      .bubble11 {
        width: 8px;
        height: 8px;
        left: 38%;
        animation: rise 2.5s infinite ease-out;
        animation-delay: 3s;
      }
      .bubble12 {
        width: 13px;
        height: 13px;
        left: 46%;
        animation: rise 3.3s infinite ease-out;
        animation-delay: 3.3s;
      }
      .bubble13 {
        width: 11px;
        height: 11px;
        left: 54%;
        animation: rise 2.9s infinite ease-out;
        animation-delay: 3.6s;
      }
      .bubble14 {
        width: 14px;
        height: 14px;
        left: 62%;
        animation: rise 3.2s infinite ease-out;
        animation-delay: 3.9s;
      }
      .bubble15 {
        width: 9px;
        height: 9px;
        left: 70%;
        animation: rise 2.6s infinite ease-out;
        animation-delay: 4.2s;
      }

      .gas-particles {
        position: absolute;
        left: 0;
        width: 100%;
        height: 45%;
        bottom: 60%;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .gas-dot {
        position: absolute;
        bottom: 0;
        border-radius: 50%;
        width: 14px;
        height: 14px;
        background: radial-gradient(
          circle at 30% 30%,
          rgba(255, 240, 220, 1),
          rgba(185, 28, 28, 0.95)
        );
        opacity: 0;
        box-shadow: 0 0 8px rgba(248, 113, 113, 0.9);
      }

      @keyframes gasRise {
        0% {
          transform: translateY(0) scale(0.6);
          opacity: 0;
        }
        20% {
          opacity: 1;
        }
        100% {
          transform: translateY(-130px) scale(1.1);
          opacity: 0;
        }
      }

      .gas-dot1 {
        left: 15%;
        animation: gasRise 3s infinite ease-out;
        animation-delay: 0s;
      }
      .gas-dot2 {
        left: 25%;
        width: 16px;
        height: 16px;
        animation: gasRise 3.2s infinite ease-out;
        animation-delay: 0.3s;
      }
      .gas-dot3 {
        left: 35%;
        width: 13px;
        height: 13px;
        animation: gasRise 2.9s infinite ease-out;
        animation-delay: 0.6s;
      }
      .gas-dot4 {
        left: 45%;
        width: 15px;
        height: 15px;
        animation: gasRise 3.3s infinite ease-out;
        animation-delay: 0.9s;
      }
      .gas-dot5 {
        left: 55%;
        width: 14px;
        height: 14px;
        animation: gasRise 2.7s infinite ease-out;
        animation-delay: 1.2s;
      }
      .gas-dot6 {
        left: 65%;
        width: 12px;
        height: 12px;
        animation: gasRise 3.1s infinite ease-out;
        animation-delay: 1.5s;
      }
      .gas-dot7 {
        left: 75%;
        width: 16px;
        height: 16px;
        animation: gasRise 3.4s infinite ease-out;
        animation-delay: 1.8s;
      }
      .gas-dot8 {
        left: 20%;
        width: 13px;
        height: 13px;
        animation: gasRise 2.8s infinite ease-out;
        animation-delay: 2.1s;
      }
      .gas-dot9 {
        left: 30%;
        width: 15px;
        height: 15px;
        animation: gasRise 3s infinite ease-out;
        animation-delay: 2.4s;
      }
      .gas-dot10 {
        left: 40%;
        width: 12px;
        height: 12px;
        animation: gasRise 3.2s infinite ease-out;
        animation-delay: 2.7s;
      }
      .gas-dot11 {
        left: 50%;
        width: 14px;
        height: 14px;
        animation: gasRise 2.9s infinite ease-out;
        animation-delay: 3s;
      }
      .gas-dot12 {
        left: 60%;
        width: 13px;
        height: 13px;
        animation: gasRise 3.3s infinite ease-out;
        animation-delay: 3.3s;
      }

      .ratio-wrapper {
        margin-bottom: 8px;
        font-size: 13px;
      }

      .ratio-label {
        margin-bottom: 4px;
        color: #bae6fd;
      }

      .ratio-inputs {
        display: flex;
        align-items: center;
        gap: 6px;
        flex-wrap: wrap;
      }

      .ratio-inputs span {
        font-weight: bold;
        color: #e0f2fe;
      }

      .ratio-inputs input {
        width: 46px;
        padding: 4px 6px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.9);
        background: rgba(15, 23, 42, 0.9);
        color: #e5e7eb;
        text-align: center;
        outline: none;
        box-shadow: 0 0 6px rgba(56, 189, 248, 0.4);
        font-size: 13px;
      }

      .ratio-inputs input:focus {
        border-color: #38bdf8;
        box-shadow: 0 0 8px #38bdf8, 0 0 14px #0ea5e9;
      }

      .ratio-inputs input.error {
        border-color: #f97373;
        box-shadow: 0 0 10px rgba(248, 113, 113, 0.9),
          0 0 18px rgba(248, 113, 113, 0.6);
      }

      /* MOBILE */
      @media (max-width: 640px) {
        body {
          padding: 4px;
        }

        .container {
          padding: 10px;
          border-radius: 14px;
        }

        /* mỗi hàng 1 ống cho dễ đọc, không bị che chữ */
        .beakers {
          grid-template-columns: 1fr;
          gap: 12px;
        }

        .card {
          padding: 8px;
          font-size: 12px;
          max-width: 380px;
          margin: 0 auto;
        }

        .card-title {
          font-size: 13px;
        }

        .top-controls {
          flex-direction: column;
          align-items: flex-start;
          font-size: 12px;
        }

        .result-box {
          font-size: 12px;
        }

        .btn {
          font-size: 11px;
          padding: 5px 8px;
        }

        .reset-btn {
          font-size: 11px;
          padding: 6px 10px;
        }

        .heat-area {
          max-width: 80px;
          height: 220px;
          margin: 0 auto 4px;
        }

        .beaker {
          transform: translateX(-50%) scale(0.8);
          transform-origin: top center;
        }

        #burner1,
        #burner2 {
          top: 195px;
          transform: translateX(-50%) scale(0.8);
        }

        .ratio-inputs input {
          width: 40px;
          font-size: 11px;
          padding: 3px 5px;
        }

        /* beaker trên – giải thích dưới */
        .card-body {
          display: grid;
          grid-template-columns: 1fr;
          grid-template-areas:
            "right"
            "left";
        }

        .right-panel {
          grid-area: right;
          text-align: center;
        }

        .left-panel {
          grid-area: left;
          text-align: left;
          padding-top: 6px;
        }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h1>Mô phỏng thí nghiệm nước cường toan với vàng (Au)</h1>

      <div class="top-controls">
        <div>
          Ban đầu các ống nghiệm KHÔNG có dung dịch. Nhấn nút để đổ dung dịch,
          đun nóng và quan sát vàng.
        </div>
        <button id="resetAll" class="reset-btn">Đặt lại</button>
      </div>

      <div class="beakers">
        <!-- ỐNG 1 -->
        <div class="card">
          <div class="card-title">Ống 1: HNO₃ đặc</div>
          <div class="card-body">
            <div class="left-panel">
              <div class="controls">
                <button class="btn" id="fill1">Đổ HNO₃</button>
                <button class="btn green" id="heat1">Đun nóng</button>
              </div>
              <div id="res1" class="result-box">Ống chưa có dung dịch.</div>
            </div>

            <div class="right-panel">
              <div class="heat-area">
                <div class="beaker">
                  <div id="sol1" class="solution"></div>
                  <div id="gold1" class="gold"></div>
                </div>
                <div id="burner1">
                  <div class="burner-base"></div>
                  <div class="burner-neck"></div>
                  <div class="flame"></div>
                  <div class="flame-inner"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ỐNG 2 -->
        <div class="card">
          <div class="card-title">Ống 2: HCl đặc</div>
          <div class="card-body">
            <div class="left-panel">
              <div class="controls">
                <button class="btn" id="fill2">Đổ HCl</button>
                <button class="btn green" id="heat2">Đun nóng</button>
              </div>
              <div id="res2" class="result-box">Ống chưa có dung dịch.</div>
            </div>

            <div class="right-panel">
              <div class="heat-area">
                <div class="beaker">
                  <div id="sol2" class="solution"></div>
                  <div id="gold2" class="gold"></div>
                </div>
                <div id="burner2">
                  <div class="burner-base"></div>
                  <div class="burner-neck"></div>
                  <div class="flame"></div>
                  <div class="flame-inner"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ỐNG 3 -->
        <div class="card">
          <div class="card-title">
            Ống 3: Nước cường toan (chọn tỉ lệ HNO₃ : HCl)
          </div>
          <div class="card-body">
            <div class="left-panel">
              <div class="ratio-wrapper">
                <div class="ratio-label">Chọn tỉ lệ HNO₃ : HCl</div>
                <div class="ratio-inputs">
                  <input
                    type="number"
                    id="ratioHNO3"
                    value="1"
                    min="1"
                    max="10"
                  />
                  <span>:</span>
                  <input
                    type="number"
                    id="ratioHCl"
                    value="3"
                    min="1"
                    max="30"
                  />
                </div>
              </div>

              <div class="controls">
                <button class="btn" id="mix3">Trộn &amp; cho vàng</button>
              </div>

              <div id="res3" class="result-box">Ống chưa có dung dịch.</div>
            </div>

            <div class="right-panel">
              <div class="heat-area">
                <div class="beaker">
                  <div id="sol3" class="solution"></div>

                  <div id="bubbles3" class="bubbles">
                    <div class="bubble bubble1"></div>
                    <div class="bubble bubble2"></div>
                    <div class="bubble bubble3"></div>
                    <div class="bubble bubble4"></div>
                    <div class="bubble bubble5"></div>
                    <div class="bubble bubble6"></div>
                    <div class="bubble bubble7"></div>
                    <div class="bubble bubble8"></div>
                    <div class="bubble bubble9"></div>
                    <div class="bubble bubble10"></div>
                    <div class="bubble bubble11"></div>
                    <div class="bubble bubble12"></div>
                    <div class="bubble bubble13"></div>
                    <div class="bubble bubble14"></div>
                    <div class="bubble bubble15"></div>
                  </div>

                  <div id="gas3" class="gas-particles">
                    <div class="gas-dot gas-dot1"></div>
                    <div class="gas-dot gas-dot2"></div>
                    <div class="gas-dot gas-dot3"></div>
                    <div class="gas-dot gas-dot4"></div>
                    <div class="gas-dot gas-dot5"></div>
                    <div class="gas-dot gas-dot6"></div>
                    <div class="gas-dot gas-dot7"></div>
                    <div class="gas-dot gas-dot8"></div>
                    <div class="gas-dot gas-dot9"></div>
                    <div class="gas-dot gas-dot10"></div>
                    <div class="gas-dot gas-dot11"></div>
                    <div class="gas-dot gas-dot12"></div>
                  </div>

                  <div id="gold3" class="gold"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const sol1 = document.getElementById("sol1");
      const sol2 = document.getElementById("sol2");
      const sol3 = document.getElementById("sol3");

      const gold1 = document.getElementById("gold1");
      const gold2 = document.getElementById("gold2");
      const gold3 = document.getElementById("gold3");

      const burner1 = document.getElementById("burner1");
      const burner2 = document.getElementById("burner2");

      const bubbles3 = document.getElementById("bubbles3");
      const gas3 = document.getElementById("gas3");

      const res1 = document.getElementById("res1");
      const res2 = document.getElementById("res2");
      const res3 = document.getElementById("res3");

      const fill1 = document.getElementById("fill1");
      const heat1 = document.getElementById("heat1");
      const fill2 = document.getElementById("fill2");
      const heat2 = document.getElementById("heat2");
      const mix3 = document.getElementById("mix3");
      const resetAllBtn = document.getElementById("resetAll");

      const ratioHNO3Input = document.getElementById("ratioHNO3");
      const ratioHClInput = document.getElementById("ratioHCl");

      let interval3 = null;

      function gcd(a, b) {
        a = Math.abs(a);
        b = Math.abs(b);
        while (b !== 0) {
          const t = b;
          b = a % b;
          a = t;
        }
        return a || 1;
      }

      function clearRatioError() {
        ratioHNO3Input.classList.remove("error");
        ratioHClInput.classList.remove("error");
        res3.classList.remove("error");
      }

      function setRatioError() {
        ratioHNO3Input.classList.add("error");
        ratioHClInput.classList.add("error");
        res3.classList.add("error");
      }

      function resetAll() {
        [sol1, sol2, sol3].forEach((s) => {
          s.style.height = "0%";
          s.style.background = "linear-gradient(to top, #22d3ee, #38bdf8)";
        });

        [gold1, gold2, gold3].forEach((g) => {
          g.style.transform = "translateX(-50%) scale(1)";
          g.style.opacity = "1";
        });

        bubbles3.style.opacity = "0";
        gas3.style.opacity = "0";
        burner1.style.opacity = "0";
        burner2.style.opacity = "0";

        if (interval3) {
          clearInterval(interval3);
          interval3 = null;
        }

        res1.innerText = "Ống chưa có dung dịch.";
        res2.innerText = "Ống chưa có dung dịch.";
        res3.innerText = "Ống chưa có dung dịch.";

        ratioHNO3Input.value = 1;
        ratioHClInput.value = 3;

        clearRatioError();
      }

      resetAllBtn.onclick = resetAll;
      resetAll();

      // ỐNG 1 – HNO3 đặc
      fill1.onclick = () => {
        sol1.style.height = "55%";
        res1.innerText =
          "Đã đổ HNO₃ đặc (nguội) vào ống.\n" +
          "Cho vàng vào → hầu như không có hiện tượng, vàng không tan.";
      };

      heat1.onclick = () => {
        if (!sol1.style.height || parseInt(sol1.style.height) === 0) {
          sol1.style.height = "55%";
        }
        burner1.style.opacity = "1";
        res1.innerText =
          "Đặc biệt: đun nóng HNO₃ đặc bằng đèn cồn giữa đáy ống và vùng nút.\n" +
          "Ngọn lửa xuất hiện nhưng vàng vẫn không tan, không có khí phản ứng như với nước cường toan.";
      };

      // ỐNG 2 – HCl đặc
      fill2.onclick = () => {
        sol2.style.height = "55%";
        res2.innerText =
          "Đã đổ HCl đặc (nguội) và cho vàng vào.\n" +
          "Vàng không tan, không có bọt khí.";
      };

      heat2.onclick = () => {
        if (!sol2.style.height || parseInt(sol2.style.height) === 0) {
          sol2.style.height = "55%";
        }
        burner2.style.opacity = "1";
        res2.innerText =
          "Đun nóng HCl đặc trong ống có chứa vàng, bằng đèn cồn đặt giữa đáy ống và vùng nút.\n" +
          "Dù đun nóng, vàng vẫn không tan, không xuất hiện bọt khí hay khí thoát ra rõ rệt.\n" +
          "⇒ Giống như HNO₃ đặc, HCl đặc riêng lẻ không hòa tan được vàng.";
      };

      // ỐNG 3 – nước cường toan với tỉ lệ chọn tự do
      mix3.onclick = () => {
        const hno = parseInt(ratioHNO3Input.value, 10);
        const hcl = parseInt(ratioHClInput.value, 10);

        if (interval3) {
          clearInterval(interval3);
          interval3 = null;
        }

        sol3.style.height = "60%";
        gold3.style.opacity = "1";
        gold3.style.transform = "translateX(-50%) scale(1)";
        bubbles3.style.opacity = "0";
        gas3.style.opacity = "0";

        clearRatioError();

        const validNumbers =
          Number.isFinite(hno) && Number.isFinite(hcl) && hno > 0 && hcl > 0;
        const isCorrectRatio = validNumbers && hcl === 3 * hno;

        if (isCorrectRatio) {
          // đúng tỉ lệ → tan vàng
          sol3.style.background = "#fffbd1";

          let time = 0;
          const total = 6000;
          const step = 120;
          const startBubbleThreshold = 0.4;

          interval3 = setInterval(() => {
            time += step;
            let p = time / total;
            if (p > 1) p = 1;

            const size = 1 - 0.9 * p;
            const op = 1 - p;
            gold3.style.transform = `translateX(-50%) scale(${Math.max(
              size,
              0
            )})`;
            gold3.style.opacity = Math.max(op, 0);

            const colors = ["#fffbd1", "#fde68a", "#facc15", "#f59e0b"];
            const idx = Math.min(
              colors.length - 1,
              Math.floor(p * colors.length)
            );
            sol3.style.background = colors[idx] || colors[colors.length - 1];

            if (p >= startBubbleThreshold && p < 1) {
              const q = (p - startBubbleThreshold) / (1 - startBubbleThreshold);
              const intensity = Math.min(1, 0.3 + q * 1.2);
              bubbles3.style.opacity = intensity;
              gas3.style.opacity = intensity;
            } else if (p < startBubbleThreshold) {
              bubbles3.style.opacity = "0";
              gas3.style.opacity = "0";
            }

            if (p >= 1) {
              clearInterval(interval3);
              interval3 = null;
              bubbles3.style.opacity = "0";
              gas3.style.opacity = "0";
            }
          }, step);

          const g = gcd(hno, hcl);
          const simpleA = hno / g;
          const simpleB = hcl / g;

          const extra =
            simpleA === 1 && simpleB === 3
              ? "Đây chính là tỉ lệ 1 : 3 chuẩn."
              : `Tỉ lệ ${hno} : ${hcl} rút gọn về <b>${simpleA} : ${simpleB}</b>, tương đương với 1 : 3.`;

          res3.classList.remove("error");
          res3.innerHTML =
            `Bạn đã chọn tỉ lệ <b>${hno} : ${hcl}</b> với HCl = 3×HNO₃.<br>` +
            extra +
            "<br>" +
            "Dung dịch tạo thành là nước cường toan chuẩn → vàng dần tan ra, bọt khí xuất hiện ngày càng nhiều và có khối khí nâu đỏ (NO₂) bay lên trong suốt quá trình vàng tan.<br><br>" +
            "<b>Phương trình minh họa (một dạng thường gặp):</b><br>" +
            "Au + 3HNO<sub>3</sub> + 4HCl → HAuCl<sub>4</sub> + 3NO<sub>2</sub> + 3H<sub>2</sub>O";
        } else {
          // sai tỉ lệ → không tan + viền đỏ
          sol3.style.background = "linear-gradient(to top, #22d3ee, #38bdf8)";
          gold3.style.opacity = "1";
          gold3.style.transform = "translateX(-50%) scale(1)";
          bubbles3.style.opacity = "0";
          gas3.style.opacity = "0";

          setRatioError();

          if (!validNumbers) {
            res3.innerHTML =
              "Vui lòng nhập số nguyên dương cho cả HNO₃ và HCl.<br>" +
              "Chỉ những tỉ lệ có HCl = 3×HNO₃ (1:3, 2:6, 3:9, ...) mới tạo thành nước cường toan chuẩn hòa tan vàng.";
          } else {
            res3.innerHTML =
              `Bạn đã chọn tỉ lệ <b>${hno} : ${hcl}</b> (không thỏa mãn HCl = 3×HNO₃).<br>` +
              "Dung dịch tạo thành KHÔNG phải nước cường toan chuẩn, nên vàng hầu như không tan, không có bọt khí và khí nâu đỏ rõ rệt.<br>" +
              "⇒ Chỉ khi tỉ lệ HNO₃ : HCl là 1 : 3 hoặc các bội số của nó (2 : 6, 3 : 9, ...) thì vàng mới tan rõ trong nước cường toan.";
          }
        }
      };
    </script>
    <link rel="stylesheet" href="chatbox/chatbox.css?v=1" />
    <script defer src="chatbox/chatbox.js?v=1"></script>
  </body>
</html>

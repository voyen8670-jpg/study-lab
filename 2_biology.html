<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>M√¥ ph·ªèng: Amylase th·ªßy ph√¢n tinh b·ªôt</title>
  <style>
    body{font-family:Arial, sans-serif;background:#071227;color:#e8f6ff;margin:0;padding:18px;display:flex;justify-content:center}
    .wrap{max-width:1200px;width:100%}
    h1{margin:0 0 12px;font-size:20px;text-align:center;color:#fff}
    .bench{display:flex;justify-content:space-between;align-items:flex-start;gap:20px}
    .tube{width:110px;height:300px;border:2px solid rgba(255,255,255,0.15);border-radius:18px 18px 30px 30px;position:relative;overflow:hidden;background:rgba(255,255,255,0.03)}
    .neck{position:absolute;top:-28px;left:calc(50% - 22px);width:44px;height:50px;border-radius:8px;background:rgba(255,255,255,0.05)}
    .liquid{
      position:absolute;left:0;right:0;bottom:0;height:0;
      transition:height 1.5s ease, background 3s ease-in-out;
      border-radius:0 0 28px 28px;
      opacity:0.95;
      background-size:200% 200%;
    }
    .label{position:absolute;top:6px;left:10px;font-size:13px;color:#cfe3ff}
    .caption{text-align:center;margin-top:6px;font-size:14px}
    .controls{margin-top:10px;display:flex;gap:6px;flex-wrap:wrap;justify-content:center}
    button{padding:6px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.07);color:#e6f5ff;cursor:pointer;transition:background 0.3s}
    button:hover{background:rgba(255,255,255,0.15)}
    .explain{flex:1;background:rgba(255,255,255,0.04);padding:16px;border-radius:10px;font-size:17px;line-height:1.7;margin-top:20px}
    table{width:100%;border-collapse:collapse;margin-top:10px;color:#dfeeff}
    td,th{padding:5px;border-bottom:1px dashed rgba(255,255,255,0.1);font-size:13px;text-align:left}
    pre{background:rgba(255,255,255,0.03);color:#fff;padding:10px;font-size:18px;border-radius:6px;white-space:pre-wrap;text-align:center}
    .footerExplain{margin-top:18px;background:rgba(255,255,255,0.05);padding:14px;border-radius:12px;line-height:1.5;font-size:15px}
    .footerExplain strong{color:#7fd7ff}
  </style>
</head>
<body>
<div class="wrap">
  <h1>M√¥ ph·ªèng: Ho·∫°t t√≠nh th·ªßy ph√¢n tinh b·ªôt c·ªßa amylase</h1>

  <div class="bench">
    <!-- ·ªêng nghi·ªám 1 -->
    <div style="display:flex;flex-direction:column;align-items:center;width:33%">
      <div class="tube" id="tube1">
        <div class="neck"></div>
        <div class="label">·ªêng 1</div>
        <div class="liquid" id="liq1"></div>
      </div>
      <div class="caption">·ªêng 1: Tinh b·ªôt + H‚ÇÇO + Lugol</div>
      <div class="controls">
        <button onclick="addLiquid(1,'starch')">+ Tinh b·ªôt (Starch)</button>
        <button onclick="addLiquid(1,'water')">+ N∆∞·ªõc (Water)</button>
        <button onclick="addLiquid(1,'lugol')">+ Lugol (Iodine)</button>
        <button onclick="resetTube(1)">üîÑ Reset</button>
      </div>
      <table>
        <thead><tr><th>Ch·∫•t (VN/EN)</th><th>Th·ªÉ t√≠ch (mL)</th></tr></thead>
        <tbody id="tbl1"><tr><td>-</td><td>0</td></tr></tbody>
      </table>
    </div>

    <!-- Gi·∫£i th√≠ch thao t√°c ·ªü gi·ªØa -->
    <div class="explain" id="explain">
      <strong>üîé Gi·∫£i th√≠ch theo thao t√°c</strong>
      <div id="explainText" style="margin-top:8px">
        H√£y b·∫•m th√™m c√°c ch·∫•t ƒë·ªÉ quan s√°t hi·ªán t∆∞·ª£ng v√† ƒë·ªçc gi·∫£i th√≠ch t·∫°i ƒë√¢y.
      </div>
    </div>

    <!-- ·ªêng nghi·ªám 2 -->
    <div style="display:flex;flex-direction:column;align-items:center;width:33%">
      <div class="tube" id="tube2">
        <div class="neck"></div>
        <div class="label">·ªêng 2</div>
        <div class="liquid" id="liq2"></div>
      </div>
      <div class="caption">·ªêng 2: Tinh b·ªôt + Amylase + Lugol</div>
      <div class="controls">
        <button onclick="addLiquid(2,'starch')">+ Tinh b·ªôt (Starch)</button>
        <button onclick="addLiquid(2,'amylase')">+ Amylase</button>
        <button onclick="addLiquid(2,'lugol')">+ Lugol (Iodine)</button>
        <button onclick="resetTube(2)">üîÑ Reset</button>
      </div>
      <table>
        <thead><tr><th>Ch·∫•t (VN/EN)</th><th>Th·ªÉ t√≠ch (mL)</th></tr></thead>
        <tbody id="tbl2"><tr><td>-</td><td>0</td></tr></tbody>
      </table>
    </div>
  </div>

    <!-- Gi·∫£i th√≠ch sinh h·ªçc cu·ªëi -->
  <div class="footerExplain">
    <strong>üî¨ Gi·∫£i th√≠ch sinh h·ªçc</strong><br><br>
    <p>Amylase l√† m·ªôt lo·∫°i enzyme x√∫c t√°c cho ph·∫£n ·ª©ng th·ªßy ph√¢n li√™n k·∫øt Œ±-1,4-glycosidic trong ph√¢n t·ª≠ tinh b·ªôt (amylose v√† amylopectin).</p>
    <p>Khi cho dung d·ªãch tinh b·ªôt v√†o ·ªëng nghi·ªám, n·∫øu nh·ªè th√™m dung d·ªãch Iod (I‚ÇÇ/KI) s·∫Ω th·∫•y <b>m√†u xanh t√≠m ƒë·∫≠m</b> do iod g·∫Øn v√†o c·∫•u tr√∫c xo·∫Øn l√≤ xo c·ªßa amylose.</p>
    <p>Khi th√™m enzyme amylase, tinh b·ªôt d·∫ßn b·ªã c·∫Øt nh·ªè th√†nh c√°c ƒë∆∞·ªùng ƒë√¥i <b>maltose</b> v√† c√°c ƒëo·∫°n ng·∫Øn h∆°n (<b>dextrin</b>).</p>
    <p>Do c·∫•u tr√∫c amylose b·ªã ph√° v·ª°, iod kh√¥ng c√≤n ch·ªó ƒë·ªÉ g·∫Øn ‚Üí <b>m√†u xanh t√≠m bi·∫øn m·∫•t</b>.</p>
    <p>Hi·ªán t∆∞·ª£ng n√†y ch·ª©ng minh r·∫±ng amylase c√≥ kh·∫£ nƒÉng th·ªßy ph√¢n tinh b·ªôt, t·∫°o ra s·∫£n ph·∫©m ƒë∆∞·ªùng ƒë√¥i, d·ªÖ h√≤a tan v√† kh√¥ng ph·∫£n ·ª©ng m√†u v·ªõi iod.</p>
  </div>

  <div class="footerExplain">
    <strong>‚ö° Ph∆∞∆°ng tr√¨nh t·ªïng qu√°t:</strong>
    <pre>(C‚ÇÜH‚ÇÅ‚ÇÄO‚ÇÖ)n + n H‚ÇÇO  ‚Äî(amylase)‚Üí  n C‚ÇÅ‚ÇÇH‚ÇÇ‚ÇÇO‚ÇÅ‚ÇÅ (maltose)</pre>
  </div>
</div>

<script>
  const colors={
  starch:"linear-gradient(180deg,#ffffff,#f2f2f2,#d9d9d9)", 
  water:"linear-gradient(180deg,#e9f8ff,#bfe7ff,#90d4ff)",  
  amylase:"linear-gradient(180deg,#f3feff,#c9f7ff,#9eeaff)", 
  lugol:"linear-gradient(180deg,#fbe48c,#d4a12e,#8a5a0a)", 
  starchLugol:"linear-gradient(180deg,#7b2cbf,#3a0ca3)"  // t√≠m xanh lu√¥n
};

  let vols1={}, vols2={};
  let state1={starch:false,water:false,lugol:false};
  let state2={starch:false,amylase:false,lugol:false};
  const explainText=document.getElementById("explainText");

  function calcHeight(vols){
    let total=0;
    for(const k in vols) total+=vols[k];
    return Math.min(70,total*3)+"%"; 
  }

  function updateTube(id){
    const tube=document.getElementById("liq"+id);
    let s=(id===1?state1:state2);
    let vols=(id===1?vols1:vols2);
    let h=calcHeight(vols);

    if(id===1){
      if(s.starch && s.water && s.lugol){ 
        tube.style.background=colors.starchLugol;
        explainText.innerHTML="·ªêng 1: Tinh b·ªôt + n∆∞·ªõc ‚Üí tr·∫Øng ƒë·ª•c. Th√™m Lugol ‚Üí <b>xanh t√≠m</b> do ph·ª©c amylose‚Äìiod.";
      }
      else if(s.starch && s.water){ 
        tube.style.background=colors.starch;
        explainText.innerHTML="·ªêng 1: Tinh b·ªôt + n∆∞·ªõc ‚Üí t·∫°o huy·ªÅn ph√π tr·∫Øng ƒë·ª•c.";
      }
      else if(s.starch){ 
        tube.style.background=colors.starch;
        explainText.innerHTML="·ªêng 1: Ch·ªâ c√≥ tinh b·ªôt ‚Üí tr·∫Øng ƒë·ª•c, m·ª±c th·∫•p.";
      }
      else if(s.water){ 
        tube.style.background=colors.water;
        explainText.innerHTML="·ªêng 1: Ch·ªâ c√≥ n∆∞·ªõc ‚Üí trong su·ªët, m·ª±c th·∫•p.";
      }
      else if(s.lugol){ 
        tube.style.background=colors.lugol;
        explainText.innerHTML="·ªêng 1: Ch·ªâ c√≥ Lugol ‚Üí dung d·ªãch n√¢u v√†ng.";
      }
      else{h="0"; explainText.innerHTML="·ªêng 1: R·ªóng.";}
    }

    if(id===2){
      if(s.starch && s.amylase && s.lugol){ 
        tube.style.background=colors.lugol;
        explainText.innerHTML="·ªêng 2: Amylase ph√¢n gi·∫£i tinh b·ªôt. Th√™m Lugol ‚Üí v·∫´n <b>n√¢u v√†ng</b>, kh√¥ng xanh t√≠m.";
      }
      else if(s.starch && s.amylase){ 
        tube.style.background=colors.starch;
        explainText.innerHTML="·ªêng 2: Tinh b·ªôt + amylase ‚Üí dung d·ªãch tr·∫Øng ƒë·ª•c, ƒëang th·ªßy ph√¢n.";
      }
      else if(s.starch){ 
        tube.style.background=colors.starch;
        explainText.innerHTML="·ªêng 2: Ch·ªâ c√≥ tinh b·ªôt ‚Üí tr·∫Øng ƒë·ª•c, m·ª±c th·∫•p.";
      }
      else if(s.amylase){ 
        tube.style.background=colors.amylase;
        explainText.innerHTML="·ªêng 2: Ch·ªâ c√≥ amylase ‚Üí dung d·ªãch g·∫ßn nh∆∞ trong.";
      }
      else if(s.lugol){ 
        tube.style.background=colors.lugol;
        explainText.innerHTML="·ªêng 2: Ch·ªâ c√≥ Lugol ‚Üí dung d·ªãch n√¢u v√†ng.";
      }
      else{h="0"; explainText.innerHTML="·ªêng 2: R·ªóng.";}
    }

    tube.style.height=h;
  }

  function updateTable(id){
    const tbody=document.getElementById("tbl"+id);
    const vols=(id===1?vols1:vols2);
    let html="";
    for(const k in vols){
      if(vols[k]) html+=`<tr><td>${names[k]}</td><td>${vols[k]}</td></tr>`;
    }
    if(!html) html="<tr><td>-</td><td>0</td></tr>";
    tbody.innerHTML=html;
  }

  const names={
    starch:"Tinh b·ªôt / Starch",
    water:"N∆∞·ªõc / Water",
    amylase:"Amylase / Amylase",
    lugol:"Thu·ªëc th·ª≠ Lugol / Iodine"
  };

  function addLiquid(id,type){
    const vols=(id===1?vols1:vols2);
    if(!(type in vols)) vols[type]=0;
    vols[type]+=5; 
    if(id===1){ state1[type]=true; updateTube(1);}
    if(id===2){ state2[type]=true; updateTube(2);}
    updateTable(id);
  }

  function resetTube(id){
    const tube=document.getElementById("liq"+id);
    tube.style.height="0";
    tube.style.background="transparent";
    if(id===1){ state1={starch:false,water:false,lugol:false}; vols1={}; }
    if(id===2){ state2={starch:false,amylase:false,lugol:false}; vols2={}; }
    updateTable(id);
    explainText.innerHTML="ƒê√£ reset ·ªëng nghi·ªám "+id+".";
  }
</script>

  <!-- N√∫t m·ªü chat -->
<div id="ai-toggle" title="Tr·ª£ l√Ω AI">üí¨</div>

<!-- Khung chat -->
<div id="ai-chat">
  <div class="ai-header">
    <span>Tr·ª£ l√Ω AI</span>
    <button id="ai-close">√ó</button>
  </div>
  <div id="ai-body" class="ai-body"></div>
  <div class="ai-input">
    <input id="ai-text" type="text" placeholder="H·ªèi v·ªÅ th√≠ nghi·ªám n√†y..." />
    <button id="ai-send">‚û§</button>
  </div>
</div>

<style>
/* N√∫t m·ªü */
#ai-toggle {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: linear-gradient(135deg, #00eaff, #008cff);
  color: #000;
  font-size: 22px;
  padding: 12px;
  border-radius: 50%;
  box-shadow: 0 0 12px #00eaff;
  cursor: pointer;
  transition: transform 0.3s;
  z-index: 999999;
}
#ai-toggle:hover {
  transform: scale(1.15);
}

/* Khung chat */
#ai-chat {
  position: fixed;
  bottom: 80px;
  right: 20px;
  width: 300px;
  background: rgba(0, 0, 0, 0.92);
  border: 1px solid #00eaff;
  border-radius: 15px;
  box-shadow: 0 0 20px #00eaff44;
  display: none;
  flex-direction: column;
  overflow: hidden;
  z-index: 999998;
  transition: all 0.3s ease;
}
#ai-chat.active {
  display: flex !important;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.ai-header {
  background: #00eaff;
  color: #000;
  font-weight: bold;
  padding: 6px 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.ai-header button {
  border: none;
  background: transparent;
  font-size: 20px;
  cursor: pointer;
  color: #000;
}

.ai-body {
  padding: 10px;
  font-size: 13px;
  color: white;
  height: 260px;
  overflow-y: auto;
  background: rgba(255, 255, 255, 0.05);
}
.ai-msg,
.user-msg {
  margin: 6px 0;
  padding: 8px 10px;
  border-radius: 8px;
  line-height: 1.4;
  max-width: 80%;
}
.ai-msg {
  background: #00eaff22;
  text-align: left;
}
.user-msg {
  background: #0088ff44;
  text-align: right;
  margin-left: auto;
}

.ai-input {
  display: flex;
  border-top: 1px solid #00eaff;
}
.ai-input input {
  flex: 1;
  padding: 8px;
  border: none;
  background: transparent;
  color: white;
}
.ai-input button {
  background: #00eaff;
  color: #000;
  border: none;
  padding: 0 12px;
  cursor: pointer;
}
.ai-input button:hover {
  background: #00cfff;
}

canvas, iframe {
  pointer-events: none !important;
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function () {
  console.log("‚úÖ AI chat script loaded");
  const toggle = document.getElementById("ai-toggle");
  const chat = document.getElementById("ai-chat");
  const closeBtn = document.getElementById("ai-close");
  const sendBtn = document.getElementById("ai-send");
  const input = document.getElementById("ai-text");
  const body = document.getElementById("ai-body");
  let greeted = false;

  if (!toggle || !chat) {
    console.error("‚ùå Kh√¥ng t√¨m th·∫•y ph·∫ßn t·ª≠ chat!");
    return;
  }

  // M·ªü & ch√†o
  toggle.addEventListener("click", () => {
    console.log("üí¨ N√∫t chat ƒë∆∞·ª£c b·∫•m");
    chat.classList.toggle("active");
    if (chat.classList.contains("active") && !greeted) {
      greeted = true;
      setTimeout(() => {
        body.innerHTML += `<div class='ai-msg'>üëã Xin ch√†o! M√¨nh l√† tr·ª£ l√Ω AI c·ªßa ph√≤ng th√≠ nghi·ªám.<br>
        M√¨nh c√≥ th·ªÉ gi·∫£i ƒë√°p th·∫Øc m·∫Øc c·ªßa b·∫°n v·ªÅ th√≠ nghi·ªám n√†y</b> nh√©!</div>`;
        body.scrollTop = body.scrollHeight;
      }, 200);
    }
  });

  // ‚ùå ƒê√≥ng
  closeBtn.addEventListener("click", () => {
    chat.classList.remove("active");
    console.log("‚ùå Chat b·ªã ƒë√≥ng");
  });

  // ‚úâÔ∏è G·ª≠i tin nh·∫Øn
  async function sendMessage() {
    const msg = input.value.trim();
    if (!msg) return;
    body.innerHTML += `<div class='user-msg'>${msg}</div>`;
    input.value = "";
    body.scrollTop = body.scrollHeight;

    body.innerHTML += `<div class='ai-msg' id='typing'>ƒêang suy nghƒ©...</div>`;
    body.scrollTop = body.scrollHeight;

    try {
      const res = await fetch("/api/explain", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ question: msg })
      });
      const data = await res.json();
      document.getElementById("typing").remove();
      body.innerHTML += `<div class='ai-msg'>${data.answer}</div>`;
    } catch (e) {
      console.warn("‚ö†Ô∏è L·ªói API:", e);
      document.getElementById("typing").remove();
      body.innerHTML += `<div class='ai-msg'>‚ö†Ô∏è Kh√¥ng th·ªÉ k·∫øt n·ªëi t·ªõi m√°y ch·ªß AI.</div>`;
    }

    body.scrollTop = body.scrollHeight;
  }

  sendBtn.addEventListener("click", sendMessage);
  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") sendMessage();
  });
});
</script>
</body>
</html>
